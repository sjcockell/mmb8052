<!doctype html>
<html lang="en">
    <head>
        
            <meta charset="utf-8">
            <meta name="robots" content="noindex">
            <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
            <meta name="author" content="Simon J Cockell" />
            <meta name="date" content="2022-07-22" />
        

        <title>MMB8052 - Practical 2 | </title>

        
    
    
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
            <link rel="stylesheet" href="static/styles.css">
            <link rel="stylesheet" id="customiseCSS" href="static/light.css">
            
            
        
    <link rel="stylesheet" id="customiseCodeCSS" href="static/pygmentize.light.css">
    <link rel="stylesheet" href="static/codemirror-5.26.0/lib/codemirror.css">
    <link rel="stylesheet" href="static/code.css">
    <link rel="stylesheet" href="static/numbasEmbed.css">

    <link rel="stylesheet" href="static/bootstrap-toc.css?v=3">
    <link rel="stylesheet" href="static/print.css">


        
    
    
			<script>
				var chirun_static_url="static/.";
			</script>
            <script defer src="https://code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
            <script defer src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
            <script defer src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
            <script defer src="static/mathjax_config.js"></script>
            <script type="text/javascript" id="MathJax-script" defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
            <script defer src="static/customisation.js"></script>
            <script defer src="static/mp4.js"></script>
            
            
			</script>
        
    <script defer src="static/jquery.flexibleArea.js"></script>
    <script defer src="static/spin.min.js"></script>
    <script defer src="static/codemirror-5.26.0/lib/codemirror.js"></script>
    <script defer src="static/codemirror-5.26.0/mode/octave/octave.js"></script>
    <script defer src="static/codemirror-5.26.0/mode/python/python.js"></script>
    <script defer src="static/codemirror-5.26.0/mode/r/r.js"></script>
    <script defer src="static/code.js"></script>
    <script defer src="static/numbasEmbed.js"></script>

    <script defer src="static/bootstrap-toc.js"></script>

    </head>
    <body data-spy="scroll" data-target="#chapterTOC" data-offset="50">
        
<div class="collapse" id="navbarToggleCustomise">
	<div class="bg-secondary text-white p-3">
		<form onsubmit="return false;" id="navbarCustomise">
			<div class="form-row">
				<label>Theme Customisation</label>
				<div id="themeSelector" class="form-group col-md-12">
					<button class="btn btn-dark mr-2" value="dark">Dark</button>
					<button class="btn btn-pastel mr-2" value="pastel">Pastel</button>
					<button class="btn btn-light mr-4" value="light">Light</button>
				</div>
			</div>
			<div class="form-row">
				<div class="form-group col-md-4">
					<label style="display: block" for="font-scale">Font size (<span id="font-size-display">100%</span>)</label>
					<input type="range" class="form-control-range col-9 mr-2" id="font-scale" min="50" max="600" value="100">
					<button id="font-scale-reset" class="btn btn-sm">Reset</button>
				</div>
				<div class="form-group col-md-4">
					<label style="display: block" for="p-space">Spacing (<span id="p-space-display">100%</span>)</label>
					<input type="range" class="form-control-range col-9 mr-2" id="p-space" min="0" max="600" value="100">
					<button id="p-space-reset" class="btn btn-sm">Reset</button>
				</div>
			</div>
		</form>
	</div>
</div>

<nav aria-label="breadcrumb">
	<ul class="breadcrumb">
		<li class="breadcrumb-item">
			<a href="index.html"></a>
		</li>
		
		<li class="breadcrumb-item active">
			MMB8052 - Practical 2
		</li>
		<li class="ml-auto">
			<button class="navbar-toggler p0" type="button" data-toggle="collapse" data-target="#navbarToggleCustomise" aria-controls="navbarToggleCustomise" aria-expanded="false" aria-label="Toggle customisations panel">
				<i class="fa fa-cog" aria-hidden="true" title="Toggle customisations panel"></i> <span class="sr-only">Toggle customisations panel</span>
			</button>
		</li>
	</ul>
</nav>


        <header>
            
            
        </header>
        <main>
            
    <div class="container mt-3">
        <div class="row">
            
            <div id="sidebar" class="col-md-3">
                <nav class="mb-3" id="chapterTOC" data-toggle="toc">
                    <ul class="nav navbar-nav">
                        
                        
                        
                        <li><a id="pdf-link" class="nav-link" href="mmb8052__practical_2.pdf" target="_blank"><i class="fa fa-file-pdf-o" aria-hidden="true" title="Download as PDF"></i>&nbsp;Download as PDF</a></li>
                        
                    </ul>
                </nav>
            </div>
            <div id="content" class="col-md-9"> 
            
            <section class="section1"><h1>MMB8052 Practical 02 - Advanced Commmand Line Linux</h1>
</section><section class="section1"><h1>Introduction</h1>
<p>In the first practical we introduced the basics of the Linux command line. This second practical builds on these fundamentals to introduce more advanced tools and processes using the command line, with a particular focus on tools which process and manipulate text-based data.</p>
<p>A large amount of bioinformatics data is based on standard text formats - we've already seen UniProt database entries which are made up of structured text, and the FASTA sequence format, in which individual sequences are delineated by header lines beginning with "&gt;". Other common formats include the FASTQ format for high-throughput sequencing data, the SAM (Sequence Alignment Map) format for storing genomic alignments and the GFF (General Feature Format) which is used for recording the position of genomic features.</p>
<p>Linux tools for processing text have been around for the best part of 50 years, and as such are robust and perform well, even with the often very large files common in bioinformatics. This practical will explore a number of these tools and how they can be used to work with the type of files listed above.</p>
</section><section class="section1"><h1>Tools for Text</h1>
<section class="section2"><h2>Formats</h2>
<section class="section3"><h3>FASTA</h3>
<p>The FASTA file format is a 40-year old standard for representing either nucleotide or amino acid sequences. The first line of a FASTA entry begins with the greater-than symbol (<code>&gt;</code>), and is referred to as the description line. It should contain a unique identifier for the sequence. The lines following the description line contain the sequence data, which can be spread across multiple lines and are expected to be represented in the standard IUPAC single-letter codes. A single file can contain many sequence entries, each beginning with its own description line.</p>
<div class="highlight"><pre><span></span><code>&gt;sequence_1
CGATAGCAGATGCGATGGATAGAGATTAGATAGAGGCTCGCGCTGACGCCGCTCGATCGGCTGAGCTACGCTCGAGATCG
CGATGCGCTATCGCGCTAGCTCG
&gt;sequence_2
ATGAGCTGAGCGTAGTCGCGCATCAGCAGACTACAGCAGCAGACTCAGAACAGCAGCAGCAGCAGCACTACGCAGACTAC
GCATACGCAGACTACGCAGACGACTCAGCAGACGACTACGA
</code></pre></div>
</section><section class="section3"><h3>FASTQ</h3>
<p>The FASTQ format was developed by the Wellcome Trust Sanger Institute to store nucleotide sequence data along with associated quality scores, which provide information about the confidence of sequencing accuracy. FASTQ has become the <em>de facto</em> standard for storing the output of high-throughput sequencing instruments. An entry in a FASTQ file consists of 4 lines:</p>
<ol>
<li>Begins with an <code>@</code> character, and is followed by a sequence identifier (like the FASTA description line)</li>
<li>The sequence data (A/C/G/T/N)</li>
<li>Delimits the sequence data and the quality data - in modern files usually contains only a <code>+</code> character</li>
<li>The quality data for the bases in line 2 - must contain the same number of characters as line 2</li>
</ol>
<p>The quality scores are encoded as an ASCII value - that is a single character that can be translated into an integer numerical value, generally in the range 0 - 41. This quality score, or Phred score is related to the probability of the corresponding base call being an error (the higher the Phred score, the lower this probability).</p>
<div class="highlight"><pre><span></span><code>@NB501177:26:HF3Y2BGX2:1:11101:23339:1070 1:N:0:CGGCTATG+GTCAGTAC
GTGGCACCATGGTTGTCAGACGTCAGTGCANACANNNCTAGATGTGGGCTACAGCGCATATACTCAGGGCCATGGT
+
AAAAAEEEEEEEEEEEEAE6AEEEEEEEEE#EEE###EEEEEEEEEEEEEEEEEEEEEEEEEEEAAEEEEEEEEEE
@NB501177:26:HF3Y2BGX2:1:11101:14507:1071 1:N:0:CGGCTATG+GTCAGTAC
GCCACAGTCAGCCAGCCAAACGTATGTTAGNATTNNNCAGGTGATCACAAAACTCAGGGCCATATATAAGAACA
+
AAAAAEEEEEEEEEEEEEEEEEEEEEEEEE#EEE###EEEEEEEEEEEEEEEEEEEEEEEEEEEEAEAAEEEEE
</code></pre></div>
<p>The ASCII quality characters used for Illumina sequencing, from left-to-right in increasing order of quality:</p>
<div class="highlight"><pre><span></span><code>!"#$%&amp;'()*+,-./0123456789:;&lt;=&gt;?@ABCDEFGHIJ
</code></pre></div>
<p>Most modern Illumina sequencers use quality "bins", a small set of discrete values which means that FASTQ files can be compressed more easily. For example, bases sequenced on the NovaSeq 6000 can take one of four possible quality values 2 (<code>#</code>), 12 (<code>-</code>), 23 (<code>8</code>) and 37 (<code>F</code>). The sequences in the example above come from a NextSeq 500, which uses six bins (<code>#</code>, <code>/</code>, <code>6</code>, <code>&lt;</code>, <code>A</code>, <code>E</code>).</p>
</section><section class="section3"><h3>SAM</h3>
<p>SAM stands for <em>Sequence Alignment/Map</em> format. It is a text-based table used to record the alignment of sequence reads to a reference sequence. Each individual alignment is recorded in a single line with 11 mandatory fields separated by tab characters.</p>
<section class="section4"><h4>The header</h4>
<p>The header is an optional section of the SAM file that can describe things about the experiment as a whole. Each header line begins with the “@” character followed by a two-letter record type code. Each line is then tab-delimited.</p>
<div class="highlight"><pre><span></span><code>@HD   VN:1.0     SO:unsorted
@SQ   SN:chr1    LN:197195432
@PG   ID:bowtie2 PN:bowtie2 VN:2.3.5.1
</code></pre></div>
<p>The <code>@HD</code> line is information about the SAM file itself (version, whether or not it is sorted). <code>@SQ</code> is information about the reference sequence (there would be one line per chromosome, if we were aligning to a whole multi-chromosome genome). <code>@PG</code> is about the program that generated the SAM file.</p>
</section><section class="section4"><h4>Mandatory alignment fields</h4>
<table>
<thead>
<tr>
<th>Column</th>
<th>Description</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Query Template Name</td>
<td>Read name in the FASTQ file being mapped</td>
</tr>
<tr>
<td>2</td>
<td>Bitwise Flag</td>
<td>There’s a good description of bitwise flags here:</td>
</tr>
<tr>
<td></td>
<td></td>
<td><a href="https://davetang.org/muse/2014/03/06/understanding-bam-flags/">https://davetang.org/muse/2014/03/06/understanding-bam-flags/</a>, and a decoder</td>
</tr>
<tr>
<td></td>
<td></td>
<td>for the values in this column here:</td>
</tr>
<tr>
<td></td>
<td></td>
<td><a href="http://broadinstitute.github.io/picard/explain-flags.html">http://broadinstitute.github.io/picard/explain-flags.html</a></td>
</tr>
<tr>
<td>3</td>
<td>Reference Sequence Name</td>
<td>Sequence in the reference genome mapped to</td>
</tr>
<tr>
<td></td>
<td></td>
<td>(usually a chromosome)</td>
</tr>
<tr>
<td>4</td>
<td>1-based left most mapping</td>
<td>Beginning position of the mapping</td>
</tr>
<tr>
<td></td>
<td>position</td>
<td></td>
</tr>
<tr>
<td>5</td>
<td>Mapping Quality</td>
<td>−10log<sub>10</sub> P(mapping is wrong). A value of 255</td>
</tr>
<tr>
<td></td>
<td></td>
<td>indicates that the mapping quality is not available</td>
</tr>
<tr>
<td>6</td>
<td>CIGAR string</td>
<td>CIGAR = Concise Idiosyncratic Gapped Alignment Report</td>
</tr>
<tr>
<td></td>
<td></td>
<td><a href="https://genome.sph.umich.edu/wiki/SAM#What_is_a_CIGAR.3F">More information</a></td>
</tr>
<tr>
<td>7</td>
<td>Reference name of the</td>
<td>Relevant to paired-end data</td>
</tr>
<tr>
<td></td>
<td>mate/next segment</td>
<td></td>
</tr>
<tr>
<td>8</td>
<td>Position of the mate/next</td>
<td>Relevant to paired-end data</td>
</tr>
<tr>
<td></td>
<td>segment</td>
<td></td>
</tr>
<tr>
<td>9</td>
<td>Observed template length</td>
<td>Relevant to paired-end data</td>
</tr>
<tr>
<td>10</td>
<td>Segment Sequence</td>
<td>The sequence of the read (not the reference)</td>
</tr>
<tr>
<td>11</td>
<td>ASCII of Phred-scaled base</td>
<td>Same as the quality in Sanger-encoded FASTQ</td>
</tr>
<tr>
<td></td>
<td>base Quality+33</td>
<td></td>
</tr>
</tbody>
</table>
</section><section class="section4"><h4>Additional alignment fields</h4>
<p>All additional fields in an alignment line consist of 3 values, separated by colons, in the form TAG:TYPE:VALUE. There are a number of predefined tag types that can provide additional information about the alignment.</p>
<p>SAM alignment of the reads shown in the FASTQ example, above (generated by the alignment software <a href="http://daehwankimlab.github.io/hisat2/">HISAT2</a>):</p>
<div class="highlight"><pre><span></span><code>NB501177:26:HF3Y2BGX2:1:11101:23339:1070        0       11      6437060 60      76M     *       0       0       GTGGCACCATGGTTGTCAGACGTCAGTGCANACANNNCTAGATGTGGGCTACAGCGCATATACTCAGGGCCATGGT    AAAAAEEEEEEEEEEEEAE6AEEEEEEEEE#EEE###EEEEEEEEEEEEEEEEEEEEEEEEEEEAAEEEEEEEEEE    AS:i:-4 XN:i:0  XM:i:4  XO:i:0  XG:i:0  NM:i:4  MD:Z:30G3A0G0A39        YT:Z:UU NH:i:1
NB501177:26:HF3Y2BGX2:1:11101:14507:1071        16      1       153641443       60      73M1S   *       0       0      TGTTCTTATATATGGCCCTGAGTTTTGTGATCACCTGNNNAATNCTAACATACGTTTGGCTGGCTGACTGTGGC       EEEEEAAEAEEEEEEEEEEEEEEEEEEEEEEEEEEEE###EEE#EEEEEEEEEEEEEEEEEEEEEEEEEAAAAA      AS:i:-5 XN:i:0  XM:i:4  XO:i:0  XG:i:0  NM:i:4  MD:Z:37A0A0T3T29        YT:Z:UUNH:i:1
</code></pre></div>
</section></section><section class="section3"><h3>GFF/GTF</h3>
<p>The General Feature Format (GFF) is a standard table-based format for encoding genomic features. Each feature is encoded on one line, and each line consists of 9 columns of data. There have been 3 major versions of GFF, and the GTF (Gene Transfer Format) is very similar to GFF version 2. GFF3 is the most recent, and the preferred version of this format.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Description</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>seqid</td>
<td>Identifier of the genomic sequence the current feature is found on.</td>
</tr>
<tr>
<td>2</td>
<td>source</td>
<td>Software or database feature comes from.</td>
</tr>
<tr>
<td>3</td>
<td>type</td>
<td>The type of feature, taken from the "lite" sequence ontology (<a href="http://www.sequenceontology.org/resources/intro.html">SOFA</a>).</td>
</tr>
<tr>
<td>4</td>
<td>start</td>
<td>1-indexed start location of the feature.</td>
</tr>
<tr>
<td>5</td>
<td>end</td>
<td>1-indexed end location of the feature.</td>
</tr>
<tr>
<td>6</td>
<td>score</td>
<td>The score is usually derived by gene prediction software, and is likely an E-value or P-value. Can be left blank (".").</td>
</tr>
<tr>
<td>7</td>
<td>strand</td>
<td>+ for positive strand, - for negative strand (relative to genomic sequence in 1).</td>
</tr>
<tr>
<td>8</td>
<td>phase</td>
<td>For features of type "CDS", the phase indicates where the feature begins with reference to the reading frame. The phase is one of the integers 0, 1, or 2, indicating the number of bases that should be removed from the beginning of this feature to reach the first base of the next codon.</td>
</tr>
<tr>
<td>9</td>
<td>attributes</td>
<td>A list of feature attributes in the format tag=value. Multiple tag=value pairs are separated by semicolons.</td>
</tr>
</tbody>
</table>
<p>The flexible format of the 9th column makes this format problematic, and a GFF file needs to be examined carefully to understand what fields are found in column 9. A number of tags with pre-defined meaning are available see the <a href="http://gmod.org/wiki/GFF3">format specification</a> for more information. The GFF format is often used for defining gene structures.</p>
<div class="highlight"><pre><span></span><code>##gff-version 3
ctg123 . mRNA            1300  9000  .  +  .  ID=mrna0001;Name=sonichedgehog
ctg123 . exon            1300  1500  .  +  .  ID=exon00001;Parent=mrna0001
ctg123 . exon            1050  1500  .  +  .  ID=exon00002;Parent=mrna0001
ctg123 . exon            3000  3902  .  +  .  ID=exon00003;Parent=mrna0001
ctg123 . exon            5000  5500  .  +  .  ID=exon00004;Parent=mrna0001
ctg123 . exon            7000  9000  .  +  .  ID=exon00005;Parent=mrna0001
</code></pre></div>
</section></section><section class="section2"><h2>wc</h2>
<p>The <code>wc</code> command (word count) is a utility that given a file will list the number of lines, words and bytes in that file. The <code>-l</code> option restricts the output to just the number of lines in the file - this is particularly useful for file in which every line is a separate record, such as the case with tabular data.</p>
<p>Similarly, the <code>-w</code> option returns only the number of words in a file, and the <code>-c</code> option returns only the number of bytes (characters).</p>
<section class="exercise section3"><h3>Exercise 2.1</h3>
<p>Estimated time: 1 min</p>
<p>Use <code>wc</code> to find the number of words, lines and bytes in the file of protein sequences you downloaded in Exercise 1.8.</p>
</section></section><section class="section2"><h2>grep</h2>
<p>Searching for specific text in large files can be a laborious process - <code>grep</code> is a useful and efficient utility which simplifies this task. <code>grep phrase file</code> is a command which will search for lines which contain <code>phrase</code> in a text file called <code>file</code>.</p>
<p>If our search phrase contains special characters which are usually interpreted by the bash shell (e.g. <code>&gt;</code>, <code>&lt;</code>, <code>|</code> or <code>*</code>), then it is necessary to enclose the phrase in single quotes - <code>grep 'phrase' file</code> - to prevent bash from interpreting these characters. For example, we would count the number of sequence entries in a FASTA file by counting the lines which contain the <code>&gt;</code> character (which is used to start sequence header lines according to the FASTA specification). Since <code>&gt;</code> is interpreted by bash as the redirection of <code>STDOUT</code>, the following command would actually overwrite the <em>input</em> file, by redirecting the (non-existant) output of the <code>grep</code> command into the file:</p>
<div class="highlight"><pre><span></span><code>$ grep &gt; human.fa
</code></pre></div>
<p>To prevent this, we should ensure the search phrase is enclosed in single quotes:</p>
<div class="highlight"><pre><span></span><code>$ grep <span class="s1">'&gt;'</span> human.fa
</code></pre></div>
<p>This command will return all of the lines which contain a <code>&gt;</code> character. We could then, for example, use <code>wc</code> to count them:</p>
<div class="highlight"><pre><span></span><code>$ grep <span class="s1">'&gt;'</span> human.fa <span class="p">|</span> wc -l
</code></pre></div>
<p>This command makes use of the "pipe" character (<code>|</code>) we first encountered in practical 1 to use the output from <code>grep</code> as the input for <code>wc</code>.</p>
<p>Some useful options for <code>grep</code> include:</p>
<ul>
<li><code>-c</code> to count the number of lines containing the search phrase (this would give the same result as the piped command, above)</li>
<li><code>-i</code> to make the search case-insensitive</li>
<li><code>-o</code> to select only matching strings (rather than the whole line)</li>
<li><code>-w</code> to select only lines containing matches that form whole words</li>
<li><code>-v</code> to select non-matching lines</li>
<li><code>--color</code> to highlight matches in the selected line (on by default in most Linux distributions)</li>
</ul>
<p>Remember that <code>man grep</code> will give a full list of the available options and their descriptions.</p>
<p>We can also use the special characters <code>^</code> and <code>$</code> to match phrases at the start and end of a line, for example:</p>
<div class="highlight"><pre><span></span><code>$ grep <span class="s1">'^&gt;'</span> human.fa
</code></pre></div>
<p>Will ensure that we only match <code>&gt;</code> characters found at the <em>beginning</em> of a line (this character is a <em>qualifier</em> for the search phrase - it is not included as part of the phrase to be matched).</p>
<section class="exercise section3"><h3>Exercise 2.2</h3>
<p>Estimated time: 3-4 min</p>
<ul>
<li>If you don't still have it saved from practical 1, use <code>wget</code> to download the Retinoblastoma UniProt entry (<a href="https://rest.uniprot.org/uniprotkb/P06400.txt">https://rest.uniprot.org/uniprotkb/P06400.txt</a>)</li>
<li>The lines of a UniProt file begin with 2 characters which denote the <em>type</em> of line (documented in the user manual: <a href="https://web.expasy.org/docs/userman.html">https://web.expasy.org/docs/userman.html</a>). Use <code>grep</code>, and this information to retrieve a list of publication identifiers relevant to the Rb protein (encoded in the <code>RX</code> lines)</li>
<li>Narrow this list down to only those references which have a Digital Object Identifier (DOI). (Hint: you'll need to use a pipe (<code>|</code>) here)</li>
</ul>
<p>Consider the following:</p>
<ul>
<li>Does your first search find anything other than publication identifier lines?<ul>
<li>How could you make the search more specific to prevent this, if it is a problem?</li>
</ul>
</li>
<li>How many publications with a DOI are associated with the Rb protein?</li>
<li>How about those with a PubMed ID?</li>
</ul>
</section></section><section class="section2"><h2>Regular Expressions</h2>
<p>Searching for exact text matches is rather limited in scope - the true power of tools like <code>grep</code> becomes apparent when we can define search <em>patterns</em> which can match variable text results. Regular expressions allow us to define these types of pattern.</p>
<p><code>grep</code> actually provides the user with a number of ways of defining search patterns, the most powerful of these are Perl regular expressions (Perl is a programming language which is extremely good at text processing). These regular expressions can be "switched on" in <code>grep</code> by using the <code>-P</code> option.</p>
<p>A Perl regular expression is defined as a string of characters where each entity is either a regular character, which takes its literal meaning, or a <em>metacharacter</em>, which has a special meaning. Some metacharacter examples:</p>
<ul>
<li><code>.</code> - match <em>any</em> character</li>
<li><code>\w</code> - match any "word" character (alphanumerics and underscores)</li>
<li><code>\s</code> - match any "whitespace" character</li>
<li><code>\d</code> - match digit character (i.e. the numbers 0-9)</li>
<li><code>\D</code> - match non-digit character (i.e. anything <em>other than</em> the numbers 0-9)</li>
<li><code>\t</code> - match the tab character</li>
<li><code>\n</code> - match the newline character (i.e. what proceeds this character must be at the end of the line)</li>
<li><code>*</code> - match the preceding character (or metacharacter) zero or more times</li>
<li><code>+</code> - match the preceding character (or metacharacter) one or more times</li>
<li><code>{n}</code> - match the preceeding character (or metacharacter) exactly <code>n</code> times (where <code>n</code> is replaced by a positive whole number)</li>
<li><code>{n,}</code> - match the preceeding character at least <code>n</code> times</li>
<li><code>{m,n}</code> - match the preceeding character (or metacharacter) between <code>m</code> and <code>n</code> times (inclusive)</li>
</ul>
<p>If we want to match the actual characters (<code>.</code>, <code>+</code>, <code>*</code> etc) rather than imply their programmatic meaning as metacharacters, we will need to "escape" the character with a backslash (<code>\</code>). So if our pattern contains <code>+</code>, we need to express this so: <code>\+</code>.</p>
<p>By way of example, we will search the UniProt entry of another protein (ATM, Q13315) for the Ensembl Gene ID of the protein's parent gene. Human Ensembl Gene IDs start with ENSG, so we can use that to make a regular search of the UniProt entry:</p>
<div class="highlight"><pre><span></span><code>$ wget <span class="s1">'https://rest.uniprot.org/uniprotkb/Q13315.txt'</span>
$ grep <span class="s1">'ENSG'</span> Q13315.txt
DR   Ensembl<span class="p">;</span> ENST00000278616.9<span class="p">;</span> ENSP00000278616.4<span class="p">;</span> ENSG00000149311.20.
DR   Ensembl<span class="p">;</span> ENST00000452508.6<span class="p">;</span> ENSP00000388058.2<span class="p">;</span> ENSG00000149311.20.
DR   Ensembl<span class="p">;</span> ENST00000675843.1<span class="p">;</span> ENSP00000501606.1<span class="p">;</span> ENSG00000149311.20.
DR   HPA<span class="p">;</span> ENSG00000149311<span class="p">;</span> Low tissue specificity.
DR   OpenTargets<span class="p">;</span> ENSG00000149311<span class="p">;</span> -.
DR   VEuPathDB<span class="p">;</span> HostDB:ENSG00000149311<span class="p">;</span> -.
DR   GeneTree<span class="p">;</span> ENSGT00670000098061<span class="p">;</span> -.
DR   Bgee<span class="p">;</span> ENSG00000149311<span class="p">;</span> Expressed <span class="k">in</span> corpus callosum and <span class="m">239</span> other tissues.
     RFLCKAVENY INCLLSGEEH DMWVFRLCSL WLENSGVSEV NGMMKRDGMK IPTYKFLPLM
</code></pre></div>
<p>This search retrieves the expected database reference (DR) lines for Ensembl (among a few others), but also returns a line of the protein sequence, which contains the amino acid sequence Glu-Asn-Ser-Gly (ENSG). In this simple example we could figure out the "right" result from this simple list, but in a more complicated example, this may not be the case. To narrow down the results of our search to those line which contain genuine Ensembl Gene IDs, we will define a pattern which generally describes these identifiers. Human Ensembl Gene IDs all start with ENSG, which is then followed by 11 numbers, so a regular expression which will match <em>any</em> human Ensembl Gene ID is: <code>'ENSG\d{11}'</code> - that is the exact letters <code>ENSG</code> followed by a sequence of exactly 11 digits (<code>\d</code>):</p>
<div class="highlight"><pre><span></span><code>$ grep -P <span class="s1">'ENSG\d{11}'</span> Q13315.txt
DR   Ensembl<span class="p">;</span> ENST00000278616.9<span class="p">;</span> ENSP00000278616.4<span class="p">;</span> ENSG00000149311.20.
DR   Ensembl<span class="p">;</span> ENST00000452508.6<span class="p">;</span> ENSP00000388058.2<span class="p">;</span> ENSG00000149311.20.
DR   Ensembl<span class="p">;</span> ENST00000675843.1<span class="p">;</span> ENSP00000501606.1<span class="p">;</span> ENSG00000149311.20.
DR   HPA<span class="p">;</span> ENSG00000149311<span class="p">;</span> Low tissue specificity.
DR   OpenTargets<span class="p">;</span> ENSG00000149311<span class="p">;</span> -.
DR   VEuPathDB<span class="p">;</span> HostDB:ENSG00000149311<span class="p">;</span> -.
DR   Bgee<span class="p">;</span> ENSG00000149311<span class="p">;</span> Expressed <span class="k">in</span> corpus callosum and <span class="m">239</span> other tissues.
</code></pre></div>
<p>This more refined search removes the line of protein sequence information from the results, as well as the GeneTree database reference (which uses an identifier which looks a bit like the Ensembl Gene ID, but doesn't match it perfectly).</p>
<p>Now, if we want <em>just</em> the identifier, without any extraneous text, we can use the <code>grep</code> option <code>-o</code> which makes <code>grep</code> return only the text that matches the pattern:</p>
<div class="highlight"><pre><span></span><code>$ grep -P -o <span class="s1">'ENSG\d{11}'</span> Q13315.txt
ENSG00000149311
ENSG00000149311
ENSG00000149311
ENSG00000149311
ENSG00000149311
ENSG00000149311
ENSG00000149311
</code></pre></div>
<p>The result here repeats the Ensembl Gene ID several times, because it is found on several lines. If we just want to get it once, we can pipe these results into the <code>sort</code> command, which has an option (<code>-u</code>) to give only the unique entries in a list (the tool <code>uniq</code> does something similar, but requires the input to be sorted anyway, so we may as well just use a single tool):</p>
<div class="highlight"><pre><span></span><code>$ grep -Po <span class="s1">'ENSG\d{11}'</span> Q13315.txt <span class="p">|</span> sort -u
ENSG00000149311
</code></pre></div>
<section class="exercise section3"><h3>Exercise 2.3</h3>
<p>Estimated time: 10 min</p>
<ul>
<li>Repeat the above procedure to retrieve the Ensembl Gene ID for the Rb protein</li>
<li>Can you modify this procedure to retrieve the PubMed IDs associated with the RX lines we retrieved in exercise 2.2?</li>
<li>(More difficult) How about the DOIs? What are the common features of DOIs which can be used to build a regular expression?</li>
</ul>
</section></section><section class="section2"><h2>Other Text Processing Tools</h2>
<p>As we've seen, much can be accomplished with <code>grep</code>, and the ability to not only search text but to effectively edit it and remove only the required sections make it a powerful tool, but Linux provides us with a well stocked armoury of such tools, allowing us to do so much more. We don't have space or scope to cover everything here, but included below are some selected highlights.</p>
<section class="section3"><h3>sort</h3>
<p>The <code>sort</code> command takes a file and sorts its lines according to some natural order. By default this ordering is alphanumeric - it is possible to change this using options. With delimited text (e.g. tab- or comma-separated values) it is possible to choose the <em>field</em> you which to sort on (i.e. which column of the table). The field separator is defined using the <code>-t</code> option, and the column number to sort on is defined with the <code>-k</code> option.</p>
</section><section class="section3"><h3>uniq</h3>
<p>The <code>uniq</code> command prints a file with repeated lines omitted. As mentioned above, in order for <code>uniq</code> to find repeated lines, the file must be sorted such that these lines are next to one another. The <code>-d</code> option will print <em>only</em> the repeated lines (i.e. the duplicates), and the <code>-n</code> option will include a count for each line (i.e. how many times it was found in the file).</p>
</section><section class="section3"><h3>cut</h3>
<p><code>cut</code> is used to select sections from each line of a file. This selection can be specified in terms of bytes, characters or fields, where fields can be thought of as the columns of a table. This makes <code>cut</code> particularly useful for selecting columns from a table.</p>
<p>The <code>-f</code> option is used to select particular fields (a comma-separated list can be used to retrieve multiple columns). By default, <code>cut</code> will expect fields to be separated by the tab character. This can be changed using the <code>-d</code> option (for delimiter).</p>
</section><section class="exercise section3"><h3>Exercise 2.4</h3>
<p>Estimated time: 10 min</p>
<ul>
<li>Download the example data table: <a href="https://github.com/sjcockell/mmb8852/raw/main/practicals/data/example.txt">https://github.com/sjcockell/mmb8852/raw/main/practicals/data/example.txt</a></li>
<li><code>sort</code> the file by the corrected p-value (the column name is <code>adj.P.Val</code>), and redirect the output to a file<ul>
<li>Are the results as you would expect?</li>
<li>Where do the column headings end up?</li>
<li>Can you figure out how to <code>sort</code> the column more correctly (read the <code>man</code> page - look for the "general numeric sort", which deals with scientific notation)</li>
</ul>
</li>
<li>Use a combination of <code>tail</code>, <code>sort</code>, <code>cut</code> and <code>head</code> to remove the column headers, find and return the names of the 10 genes with the largest positive log fold-change (<code>logFC</code>)</li>
</ul>
</section></section></section><section class="section1"><h1>Scripting</h1>
<p>In addition to interpreting commands directly at the command line, <code>bash</code> can also be used to execute a list of commands saved in a text file known as a <em>script</em>. A shell script is a file containing a list of commands which are executed one at a time, and is conventionally given the file extension <code>.sh</code>.</p>
<p>Scripting is useful for a number of reasons. For example it allows us to record and reuse our process because the commands we use are stored in a file. Furthermore, by introducing programming concepts such as variables, conditionals and iteration, we can automate our process, making us more efficient with our computational work.</p>
<p>We will use the <code>nano</code> text editor we first encountered in Practical 1 to make and edit our shell scripts.  </p>
<section class="section2"><h2>Scripting Concepts</h2>
<section class="section3"><h3>Variables</h3>
<p>A <em>variable</em> is essentially a label referencing a location in memory holding an item of data. Once <em>declared</em>, variables can be used in operations, or passed to commands. The use of variables greatly increases the utility of scripts, and will often make them more readable and easier to edit.</p>
<p>We can create a variable in our script (or even at the command line) by giving it a name and assigning a value to it with the <code>=</code> operator:</p>
<div class="highlight"><pre><span></span><code><span class="nv">MYVAR</span><span class="o">=</span><span class="s2">"Hello, world!"</span>
</code></pre></div>
<p>The name of this variable is <code>MYVAR</code> and we have given it the value <code>"Hello, world!"</code>. It is important to note here that <code>bash</code> is quite picky about the formatting of this assignment - there can't be any spaces around the <code>=</code> (or <code>bash</code> will think you're trying to execute a command called <code>MYVAR</code>). Note that we've given our variable an ALL CAPS name - this isn't strictly necessary, but is the convention. One further point to make is that our variable name cannot contain characters other than alphanumerics and the underscore (<code>_</code>), or begin with a number. So <code>MYVAR</code>, <code>MY_VAR</code> and <code>MYVAR2</code> are all allowed variable names, but <code>MY VAR</code>, <code>MY-VAR</code> and <code>2MYVAR</code> are not.</p>
<p>Once we have created a variable, we can use it in subsequent lines of our script by referring to it. We do this with the <code>${}</code> operator:</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span> <span class="si">${</span><span class="nv">MYVAR</span><span class="si">}</span>
</code></pre></div>
<p>The curly braces here (<code>{}</code>) are not <em>absolutely</em> required, but can save introducing unexpected bugs in more complicated scripts. If we created a script with these two lines and ran it, we would see our script print "Hello, world!" to <code>STDOUT</code>.</p>
</section><section class="exercise section3"><h3>Exercise 2.5</h3>
<p>Estimated time: 3 min</p>
<ul>
<li>Create the 2 line script described above using <code>nano</code>. Save it as <code>my_first_script.sh</code>.</li>
<li>Run the script as follows:</li>
</ul>
<div class="highlight"><pre><span></span><code>$ bash my_first_script.sh
</code></pre></div>
<ul>
<li>Do you get the expected output, as described above?</li>
<li>If not, can you fix your script?</li>
</ul>
</section><section class="section3"><h3>Environment</h3>
<p><code>bash</code> has a number of variables preset by default, this set of variables collectively is known as our <em>environment</em>. Some examples of standard <code>bash</code> environment variables are given in the table below.</p>
<table>
<thead>
<tr>
<th>Environment Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>HOME</td>
<td>Set to your home directory (~) at login</td>
</tr>
<tr>
<td>SHELL</td>
<td>Set to the path of your currently active shell</td>
</tr>
<tr>
<td>USER</td>
<td>Set to your Linux user name</td>
</tr>
<tr>
<td>PWD</td>
<td>Changes dynamically to be your present working directory</td>
</tr>
</tbody>
</table>
<p>To find the current value of any of these variables, you can use <code>echo</code> in the same way we did above, for example:</p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">echo</span> <span class="si">${</span><span class="nv">SHELL</span><span class="si">}</span>
/bin/bash
</code></pre></div>
<p>When we create a new variable, either at the command line or in our script, that variable enters this environment. In a script, the variable only lasts as long as the script is running, and then it gets "forgotten" by <code>bash</code> (this is known as the variable's <em>scope</em>). A variable created at the command line lasts until we exit our current command line session. While a variable is in your environment, there is no limit to the number of times you can reference it. It is also possible to change the value of an existing variable (note: be careful with variable <em>reuse</em>).</p>
</section><section class="section3"><h3>Special Variables</h3>
<p>In a running script, we have access to dynamic run-time variables. These variables allow us to pass information into our script, for example consider the following script:</p>
<p><div class="highlight"><pre><span></span><code><span class="nv">MY_FIRST_ARG</span><span class="o">=</span><span class="si">${</span><span class="nv">1</span><span class="si">}</span>
<span class="nv">MY_SECOND_ARG</span><span class="o">=</span><span class="si">${</span><span class="nv">2</span><span class="si">}</span>
<span class="nb">echo</span> <span class="s2">"The values you provided at the command line were </span><span class="si">${</span><span class="nv">MY_FIRST_ARG</span><span class="si">}</span><span class="s2"> and </span><span class="si">${</span><span class="nv">MY_SECOND_ARG</span><span class="si">}</span><span class="s2">."</span>
</code></pre></div>
This script can be run as follows:</p>
<div class="highlight"><pre><span></span><code>$ bash my_second_script.sh hello world
The values you provided at the <span class="nb">command</span> line were hello and world.

The two variables referenced <span class="k">in</span> the first two lines are special variables which store the <span class="nb">command</span> line arguments passed to the script. You can pass as many arguments as you like, but you<span class="err">'</span>d have to write the code to handle them correctly. The <span class="sb">`</span><span class="si">${#}</span><span class="sb">`</span> variable tells us how many arguments there are, and <span class="sb">`</span><span class="si">${</span><span class="p">@</span><span class="si">}</span><span class="sb">`</span> provides a list of all of them.

Incorporating arguments into scripts can allow more general purpose scripts to be created, which can <span class="k">do</span> the same job <span class="k">in</span> many different ways <span class="k">in</span> response to changing arguments. For example, we can create a script to download any UniProt entry:

<span class="sb">```</span>bash
<span class="nv">UNIPROT</span><span class="o">=</span><span class="nv">$1</span>
<span class="nb">echo</span> <span class="s2">"Downloading UniProt entry: </span><span class="si">${</span><span class="nv">UNIPROT</span><span class="si">}</span><span class="s2">"</span>
wget https://rest.uniprot.org/uniprotkb/<span class="si">${</span><span class="nv">UNIPROT</span><span class="si">}</span>.txt
<span class="nb">echo</span> <span class="s2">"Done downloading"</span>
</code></pre></div>
<p>You can then invoke this script with:</p>
<div class="highlight"><pre><span></span><code>$ bash my_third_script.sh P06400
Downloading UniProt entry: P06400
<span class="o">[</span>...<span class="o">]</span>
Done downloading
</code></pre></div>
</section><section class="exercise section3"><h3>Exercise 2.6</h3>
</section><section class="section3"><h3>The FOR Loop</h3>
</section></section></section>
            </div>
        </div>
    </div>

        </main>
		
		<footer class="text-muted">
	<hr>
	<div class="container">
		<div class="float-right">
			<ul style="list-style: none">
			<li><a href="#">Back to top</a></li>
			
			
			<li><a href="mmb8052__practical_2.pdf" target="_blank"><i class="fa fa-file-pdf-o"></i>&nbsp;Download as PDF</a></li>
			
			</ul>
		</div>
		<p>Generated using <a target="_blank" href="https://github.com/chirun-ncl/chirun">Chirun</a>, written by the E-Learning Unit, School of Mathematics &amp; Statistics, Newcastle University</p>
		<p>This page last generated: 2022-07-22</p>
	</div>
</footer>
		
    </body>
</html>
